#!/usr/bin/env php
<?php

use PHPBrew\Console\Application;

if (PHP_VERSION_ID < 70200) {
    fwrite(
        STDERR,
        sprintf(
            'This version of PHPBrew is supported on PHP 7.2.0 or newer' . PHP_EOL .
            'You are using PHP %s (%s).' . PHP_EOL,
            PHP_VERSION,
            PHP_BINARY
        )
    );

    die(1);
}

(static function () : void {
    foreach ([
        __DIR__ . '/../vendor/autoload.php',
        __DIR__ . '/../../../autoload.php',
    ] as $autoload) {
        if (file_exists($autoload)) {
            require $autoload;
            return;
        }
    }

    echo 'You must set up the project dependencies, run the following commands:' . PHP_EOL
        . 'curl -sS https://getcomposer.org/installer | php' . PHP_EOL
        . 'php composer.phar install' . PHP_EOL;
    exit(1);
})();

(function () {
    /* @var $container ContainerInterface */
    $container = require __DIR__ . '/../etc/container.php';

    $container
        ->get(Application::class)
        ->run();
})();
